SGX_LOC=../../../
BASE_CFLAGS = -g -I$(SGX_LOC)user/include -I$(SGX_LOC)user/share/include -Wall -pedantic -Wno-unused-function -std=gnu11

# SGX LIB
LIBSGXDIR = $(SGX_LOC)/libsgx
SGX_CFLAGS = $(BASE_CFLAGS) -I$(LIBSGXDIR)/include -I$(LIBSGXDIR)/musl-libc/include \
             -fno-stack-protector -static -fvisibility=hidden
SGX_LDFLAGS = -static -nostdlib -nostartfiles -Wl,-T,$(SGX_LOC)user/sgx.lds
SGX_LIBS = $(LIBSGXDIR)/sgx-entry.o $(LIBSGXDIR)/libsgx.a \
           $(LIBSGXDIR)/libpolarssl-sgx.a $(LIBSGXDIR)/libc-sgx.a

CFLAGS := $(BASE_CFLAGS) -fno-stack-protector -fvisibility=hidden

ALL  := pph_enclave 

all: $(ALL)

pph-enclave.sgx: pph-enclave/%.o $(SGX_LIBS)
	$(CC) $(SGX_LDFLAGS) $< -o $@ $(SGX_LIBS)

clean:
	rm -f *.sgx

.PHONY: all clean
